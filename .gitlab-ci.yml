stages:
  - build
  - deploy

default:
  image: registry.gitlab.com/personal1741534/mail-cleanup/ubuntu-terraform:latest

build:
  stage: build
  script:
    - mkdir -p dependencies/python/python/lib/python3.13/site-packages/
    - pip install --upgrade google-api-python-client google-auth-httplib2 google-auth-oauthlib -t dependencies/python/python/lib/python3.13/site-packages/
  artifacts:
    exclude:
      - .git
      - .git/**/*
    paths:
      - /builds/personal1741534/mail-cleanup/*
    expire_in: 1h

deploy:
  stage: deploy
  script:
    - cd Terraform
    - terraform init
    - terraform apply -auto-approve
